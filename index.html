<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCX Leaderboard - Live Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .last-updated {
            color: #8dc63f;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .dashboard-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .podium-section {
            background: #1a1a1a;
            padding: 50px 30px;
            margin: 0;
        }

        .leaderboard-section {
            padding: 30px;
        }

        .podium {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 60px;
            margin: 40px 0;
            min-height: 300px;
        }

        .podium-place {
            text-align: center;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .podium-place.first { order: 1; }
        .podium-place.second { order: 2; }
        .podium-place.third { order: 3; }

        .medal-circle {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            margin: 0 auto 20px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.4);
            border: 5px solid rgba(255,255,255,0.2);
        }

        .podium-place.first .medal-circle {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            width: 200px;
            height: 200px;
        }

        .podium-place.second .medal-circle {
            background: linear-gradient(135deg, #c0c0c0, #e8e8e8);
        }

        .podium-place.third .medal-circle {
            background: linear-gradient(135deg, #cd7f32, #e8a87c);
        }

        .silhouette {
            width: 80px;
            height: 80px;
            margin-bottom: 10px;
        }

        .podium-place.first .silhouette {
            width: 90px;
            height: 90px;
        }

        .rank-number {
            font-size: 2.5em;
            font-weight: 700;
            color: #1a1a1a;
            margin-top: -5px;
        }

        .podium-place.first .rank-number {
            font-size: 3em;
        }

        .winner-info {
            color: white;
            max-width: 200px;
        }

        .winner-name {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 8px;
            color: white;
        }

        .podium-place.first .winner-name {
            font-size: 1.5em;
        }

        .winner-points {
            font-size: 1.3em;
            font-weight: 700;
            color: #8dc63f;
        }

        .podium-place.first .winner-points {
            font-size: 1.5em;
        }

        .winner-progress {
            font-size: 0.9em;
            color: #aaa;
            margin-top: 5px;
        }

        .leaderboard-section h2 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .leaderboard-table th {
            background: linear-gradient(135deg, #009677, #50b848);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .leaderboard-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .leaderboard-table tr:hover {
            background: #f8f9fa;
        }

        .rank-badge {
            display: inline-block;
            width: 40px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            border-radius: 50%;
            font-weight: 700;
            color: white;
        }

        .rank-1 { background: linear-gradient(135deg, #ffd700, #ffed4e); color: #1a1a1a; }
        .rank-2 { background: linear-gradient(135deg, #c0c0c0, #e8e8e8); color: #1a1a1a; }
        .rank-3 { background: linear-gradient(135deg, #cd7f32, #e8a87c); color: #1a1a1a; }
        .rank-other { background: linear-gradient(135deg, #009677, #50b848); }

        .progress-bar {
            background: #e0e0e0;
            height: 25px;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            background: linear-gradient(90deg, #009677, #8dc63f);
            height: 100%;
            border-radius: 12px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 12px;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: white;
        }

        .loading-spinner {
            border: 4px solid rgba(255,255,255,0.1);
            border-top: 4px solid #8dc63f;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #f44336;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px;
            text-align: center;
        }

        .empty-state {
            text-align: center;
            padding: 60px;
            color: #999;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #50b848, #8dc63f);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            transition: all 0.3s;
        }

        .refresh-btn:hover {
            background: linear-gradient(135deg, #009677, #50b848);
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            .podium {
                flex-direction: column;
                gap: 30px;
            }

            .podium-place {
                order: unset !important;
            }

            .medal-circle {
                width: 160px !important;
                height: 160px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ CCX Leaderboard</h1>
            <div class="last-updated" id="last-updated">Loading...</div>
        </div>

        <div id="loading" class="loading">
            <div class="loading-spinner"></div>
            <p>Loading leaderboard data...</p>
        </div>

        <div id="error" style="display: none;"></div>

        <div id="dashboard" style="display: none;">
            <button class="refresh-btn" onclick="loadData()">üîÑ Refresh Data</button>
            
            <div class="dashboard-container">
                <div class="podium-section">
                    <h2 style="text-align: center; color: white; margin-bottom: 30px;">üèÜ Top 3 Champions</h2>
                    <div id="podium"></div>
                </div>

                <div class="leaderboard-section">
                    <h2>Full Leaderboard</h2>
                    <table class="leaderboard-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Learner Name</th>
                                <th>Total Points</th>
                                <th>Activities Completed</th>
                                <th>Progress</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURATION - 1JKFVmoxmdJk-n59SaFL5yQ483Rh_QnhvuqoYe5-kDs4
        // Instructions: 
        // 1. Create a Google Sheet with the template structure (see setup guide)
        // 2. File ‚Üí Share ‚Üí Publish to web ‚Üí Publish
        // 3. Copy the sheet ID from the URL and paste below
        const SHEET_ID = '1JKFVmoxmdJk-n59SaFL5yQ483Rh_QnhvuqoYe5-kDs4';
        const SHEET_NAME = 'Leaderboard';
        
        // Alternatively, you can use the full published CSV URL:
        // const DATA_URL = 'https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID/gviz/tq?tqx=out:csv&sheet=Leaderboard';

        const DATA_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}`;

        let leaderboardData = [];

        // Auto-refresh every 30 seconds
        let autoRefreshInterval;

        function startAutoRefresh() {
            autoRefreshInterval = setInterval(() => {
                loadData(true);
            }, 30000); // 30 seconds
        }

        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
        }

        async function loadData(silent = false) {
            if (!silent) {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('error').style.display = 'none';
            }

            try {
                const response = await fetch(DATA_URL);
                if (!response.ok) {
                    throw new Error('Failed to fetch data. Please check your Sheet ID and make sure the sheet is published.');
                }
                
                const csvText = await response.text();
                const data = parseCSV(csvText);
                
                if (data.length === 0) {
                    throw new Error('No data found in the sheet.');
                }

                leaderboardData = processLeaderboardData(data);
                renderDashboard();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                document.getElementById('last-updated').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
                
                if (!autoRefreshInterval) {
                    startAutoRefresh();
                }
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').innerHTML = `
                    <div class="error-message">
                        <h3>‚ö†Ô∏è Error Loading Data</h3>
                        <p>${error.message}</p>
                        <p style="margin-top: 10px; font-size: 0.9em;">Make sure you've replaced 'YOUR_SHEET_ID_HERE' with your actual Google Sheet ID and published the sheet to the web.</p>
                    </div>
                `;
                document.getElementById('error').style.display = 'block';
            }
        }

        function parseCSV(csv) {
            const lines = csv.split('\n');
            const result = [];
            
            for (let i = 1; i < lines.length; i++) { // Skip header row
                const line = lines[i].trim();
                if (!line) continue;
                
                // Simple CSV parsing (handles quoted fields)
                const fields = [];
                let field = '';
                let inQuotes = false;
                
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        fields.push(field.trim());
                        field = '';
                    } else {
                        field += char;
                    }
                }
                fields.push(field.trim());
                
                if (fields.length > 0 && fields[0]) {
                    result.push(fields);
                }
            }
            
            return result;
        }

        function processLeaderboardData(data) {
            return data
                .map(row => {
                    const name = row[0] || '';
                    if (!name) return null;

                    // Activities: columns 1-9
                    const activities = [];
                    for (let i = 1; i <= 9; i++) {
                        const value = parseInt(row[i]) || 0;
                        activities.push(value);
                    }

                    const totalPoints = activities.reduce((sum, points) => sum + points, 0);
                    const activitiesCompleted = activities.filter(p => p > 0).length;
                    const progress = (activitiesCompleted / 9) * 100;

                    return {
                        name,
                        activities,
                        totalPoints,
                        activitiesCompleted,
                        progress
                    };
                })
                .filter(item => item !== null && item.totalPoints > 0)
                .sort((a, b) => b.totalPoints - a.totalPoints)
                .map((learner, index) => ({
                    ...learner,
                    rank: index + 1
                }));
        }

        function renderDashboard() {
            renderPodium(leaderboardData);
            renderLeaderboard(leaderboardData);
        }

        function renderPodium(stats) {
            const podium = document.getElementById('podium');
            
            if (stats.length === 0) {
                podium.innerHTML = `
                    <div class="empty-state" style="color: #aaa;">
                        <h3>No data available</h3>
                        <p>Add learner data to your Google Sheet to see the podium</p>
                    </div>
                `;
                return;
            }

            const top3 = stats.slice(0, 3);
            const positions = [
                { place: 'first', data: top3[0] },
                { place: 'second', data: top3[1] },
                { place: 'third', data: top3[2] }
            ];

            const silhouetteSVG = `
                <svg class="silhouette" viewBox="0 0 24 24" fill="#1a1a1a" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
            `;

            podium.innerHTML = positions
                .filter(p => p.data)
                .map(({ place, data }) => `
                    <div class="podium-place ${place}">
                        <div class="medal-circle">
                            ${silhouetteSVG}
                            <div class="rank-number">${data.rank}</div>
                        </div>
                        <div class="winner-info">
                            <div class="winner-name">${data.name}</div>
                            <div class="winner-points">${data.totalPoints} pts</div>
                            <div class="winner-progress">${data.progress.toFixed(0)}% Complete</div>
                        </div>
                    </div>
                `).join('');
        }

        function renderLeaderboard(stats) {
            const tbody = document.getElementById('leaderboard-body');
            
            if (stats.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px;">
                            <div class="empty-state">
                                <p>No learners to display</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = stats.map(learner => `
                <tr>
                    <td>
                        <span class="rank-badge ${learner.rank <= 3 ? `rank-${learner.rank}` : 'rank-other'}">
                            ${learner.rank}
                        </span>
                    </td>
                    <td><strong>${learner.name}</strong></td>
                    <td><strong>${learner.totalPoints}</strong> points</td>
                    <td>${learner.activitiesCompleted} / 9</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${learner.progress}%">
                                ${learner.progress.toFixed(0)}%
                            </div>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Load data on page load
        window.addEventListener('load', () => {
            loadData();
        });

        // Clean up interval on page unload
        window.addEventListener('beforeunload', () => {
            stopAutoRefresh();
        });
    </script>
</body>
</html>
